import{z as L,r as m,c as s,w as S,E as le,h as g,W as Q,A as ue,g as W,O as re,ao as ce}from"./index.946ad941.js";import{a as de,u as fe,b as me,d as ve,r as $,e as j,f as he,h as ge,i as we,j as xe,k as qe,Q as ye}from"./QMenu.efd99fee.js";import{u as be,a as ke,b as Te,c as Be}from"./use-transition.0600edad.js";import{a as Se}from"./focus-manager.41046903.js";function Me(){const e=new Map;return{getCache:function(a,o){return e[a]===void 0?e[a]=o:e[a]},getCacheWithFn:function(a,o){return e[a]===void 0?e[a]=o():e[a]}}}let B=0;const Ee={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},I={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]};var Ce=L({name:"QDialog",inheritAttrs:!1,props:{...be,...ke,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:e=>e==="standard"||["top","bottom","left","right"].includes(e)}},emits:[...Te,"shake","click","escape-key"],setup(e,{slots:a,emit:o,attrs:y}){const v=W(),l=m(null),i=m(!1),f=m(!1),c=m(!1);let w,u=null,r,x;const b=s(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:k}=he(),{registerTimeout:n,removeTimeout:h}=de(),{registerTick:K,removeTick:F}=fe(),{showPortal:z,hidePortal:D,portalIsAccessible:V,renderPortal:N}=me(v,l,se,!0),{hide:T}=Be({showing:i,hideOnRouteChange:b,handleShow:ne,handleHide:oe,processOnMount:!0}),{addToHistory:U,removeFromHistory:G}=ve(i,T,b),J=s(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${Ee[e.position]}`+(c.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),X=s(()=>"q-transition--"+(e.transitionShow===void 0?I[e.position][0]:e.transitionShow)),Y=s(()=>"q-transition--"+(e.transitionHide===void 0?I[e.position][1]:e.transitionHide)),Z=s(()=>f.value===!0?Y.value:X.value),R=s(()=>`--q-transition-duration: ${e.transitionDuration}ms`),E=s(()=>i.value===!0&&e.seamless!==!0),ee=s(()=>e.autoClose===!0?{onClick:ie}:{}),te=s(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${E.value===!0?"modal":"seamless"}`,y.class]);S(i,t=>{re(()=>{f.value=t})}),S(()=>e.maximized,t=>{i.value===!0&&p(t)}),S(E,t=>{k(t),t===!0?(ge(P),we(_)):($(P),j(_))});function ne(t){h(),F(),U(),u=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,p(e.maximized),z(),c.value=!0,e.noFocus!==!0&&(document.activeElement!==null&&document.activeElement.blur(),K(q)),n(()=>{if(v.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:d,bottom:H}=document.activeElement.getBoundingClientRect(),{innerHeight:A}=window,M=window.visualViewport!==void 0?window.visualViewport.height:A;d>0&&H>M/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-M,H>=A?1/0:Math.ceil(document.scrollingElement.scrollTop+H-M/2))),document.activeElement.scrollIntoView()}x=!0,l.value.click(),x=!1}z(!0),c.value=!1,o("show",t)},e.transitionDuration)}function oe(t){h(),F(),G(),O(!0),c.value=!0,D(),u!==null&&(u.focus(),u=null),n(()=>{D(!0),c.value=!1,o("hide",t)},e.transitionDuration)}function q(t){Se(()=>{let d=l.value;d===null||d.contains(document.activeElement)===!0||(d=d.querySelector(t||"[autofocus], [data-autofocus]")||d,d.focus({preventScroll:!0}))})}function C(){q(),o("shake");const t=l.value;t!==null&&(t.classList.remove("q-animate--scale"),t.classList.add("q-animate--scale"),clearTimeout(w),w=setTimeout(()=>{l.value!==null&&(t.classList.remove("q-animate--scale"),q())},170))}function _(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&C():(o("escape-key"),T()))}function O(t){clearTimeout(w),(t===!0||i.value===!0)&&(p(!1),e.seamless!==!0&&(k(!1),$(P),j(_))),t!==!0&&(u=null)}function p(t){t===!0?r!==!0&&(B<1&&document.body.classList.add("q-body--dialog"),B++,r=!0):r===!0&&(B<2&&document.body.classList.remove("q-body--dialog"),B--,r=!1)}function ie(t){x!==!0&&(T(t),o("click",t))}function ae(t){e.persistent!==!0&&e.noBackdropDismiss!==!0?T(t):e.noShake!==!0&&C()}function P(t){e.allowFocusOutside!==!0&&V.value===!0&&ce(l.value,t.target)!==!0&&q('[tabindex]:not([tabindex="-1"])')}Object.assign(v.proxy,{focus:q,shake:C,__updateRefocusTarget(t){u=t||null}}),le(O);function se(){return g("div",{...y,class:te.value},[g(Q,{name:"q-transition--fade",appear:!0},()=>E.value===!0?g("div",{class:"q-dialog__backdrop fixed-full",style:R.value,"aria-hidden":"true",onMousedown:ae}):null),g(Q,{name:Z.value,appear:!0},()=>i.value===!0?g("div",{ref:l,class:J.value,style:R.value,tabindex:-1,...ee.value},ue(a.default)):null)])}return N}}),Fe=L({name:"QPopupProxy",props:{...xe,breakpoint:{type:[String,Number],default:450}},emits:["show","hide"],setup(e,{slots:a,emit:o,attrs:y}){const{proxy:v}=W(),{$q:l}=v,i=m(!1),f=m(null),c=s(()=>parseInt(e.breakpoint,10)),{canShow:w}=qe({showing:i});function u(){return l.screen.width<c.value||l.screen.height<c.value?"dialog":"menu"}const r=m(u()),x=s(()=>r.value==="menu"?{maxHeight:"99vh"}:{});S(()=>u(),n=>{i.value!==!0&&(r.value=n)}),Object.assign(v,{show(n){w(n)===!0&&f.value.show(n)},hide(n){f.value.hide(n)},toggle(n){f.value.toggle(n)}});function b(n){i.value=!0,o("show",n)}function k(n){i.value=!1,r.value=u(),o("hide",n)}return()=>{const n={ref:f,...x.value,...y,onShow:b,onHide:k};let h;return r.value==="dialog"?h=Ce:(h=ye,Object.assign(n,{target:e.target,contextMenu:e.contextMenu,noParentEvent:!0,separateClosePopup:!0})),g(h,n,a.default)}}});export{Fe as Q,Me as u};
